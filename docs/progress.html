<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitness Warrior Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial Black', 'Arial Bold', Arial, sans-serif; background: linear-gradient(135deg, #141e30 0%, #243b55 50%, #1a1a2e 100%); min-height: 100vh; padding: 20px; position: relative; overflow-x: hidden; }
    .container { max-width: 900px; margin: auto; background: linear-gradient(135deg, rgba(20,20,30,0.95), rgba(30,30,40,0.95)); padding: 30px; border-radius: 4px; box-shadow: 0 20px 60px rgba(0,0,0,0.8), inset 0 0 0 2px #ff6b35; border: 2px solid #ff6b35; position: relative; z-index: 1; animation: slideIn 0.6s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    .header { text-align: center; margin-bottom: 30px; position: relative; border-bottom: 3px solid #ff6b35; padding-bottom: 20px; }
    h1 { font-size: 2.8em; color: #ff6b35; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 10px; text-shadow: 0 0 20px rgba(255,107,53,0.5),0 0 40px rgba(255,107,53,0.3); font-weight:900; }
    .tagline { font-size:1em; color:#888; font-style:italic; text-transform:uppercase; letter-spacing:2px; font-weight:normal; }
    .motivation-banner { background: linear-gradient(135deg, #ff6b35, #d62828); color:white; padding:20px; border-radius:0; text-align:center; font-size:1.2em; font-weight:900; margin-bottom:25px; box-shadow:0 8px 20px rgba(255,107,53,0.5); text-transform:uppercase; letter-spacing:1px; border-left:5px solid #fff; border-right:5px solid #fff; }
    .quote-section { background: rgba(0,0,0,0.4); padding:20px; border-left:5px solid #ff6b35; margin-bottom:25px; font-style:italic; color:#ddd; font-size:1.1em; line-height:1.6; font-weight:normal; }
    .quote-author { text-align:right; color:#ff6b35; font-weight:bold; margin-top:10px; font-style:normal; }
    .cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
    @media (max-width: 600px) { .cards { grid-template-columns: 1fr; } }
    .card { padding:20px; border-radius:0; color:white; text-align:center; font-weight:900; position:relative; overflow:hidden; transition:transform 0.3s ease, box-shadow 0.3s ease; cursor:pointer; border:2px solid; text-transform:uppercase; letter-spacing:1px; min-height:120px; display:flex; flex-direction:column; justify-content:center; }
    .card:hover { transform:translateY(-5px) scale(1.03); box-shadow:0 12px 30px rgba(0,0,0,0.6); }
    .card::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:rgba(255,255,255,0.1); transition:all 0.5s; }
    .card:hover::before { left:100%; }
    .card-label { font-size:0.8em; opacity:0.9; display:block; margin-bottom:8px; font-weight:bold; }
    .card-value { font-size:2.2em; display:block; font-weight:900; }
    .start { background: linear-gradient(135deg, #1a1a2e, #2d3748); border-color: #718096; }
    .current { background: linear-gradient(135deg, #2d3748, #4a5568); border-color: #a0aec0; }
    .change-up { background: linear-gradient(135deg, #ff6b35, #d62828); border-color: #ff8555; }
    .change-down { background: linear-gradient(135deg, #10b981, #059669); border-color: #34d399; }
    .streak { background: linear-gradient(135deg, #ff6b35, #f59e0b); border-color: #fbbf24; }
    .chart-container { position:relative; background: rgba(20,20,30,0.8); padding:20px; border-radius:0; box-shadow:0 4px 15px rgba(0,0,0,0.5); margin-bottom:25px; border:2px solid #444; }
    .form { display:flex; gap:12px; margin-bottom:25px; flex-wrap:wrap; background: rgba(20,20,30,0.8); padding:20px; border-radius:0; border:2px solid #ff6b35; }
    input, button { padding:14px 18px; border-radius:0; border:2px solid transparent; font-size:15px; transition: all 0.3s ease; font-weight:bold; }
    input { flex:1; min-width:150px; background: rgba(30,30,40,0.9); border-color:#555; color:#fff; text-transform:uppercase; }
    input::placeholder { color:#888; }
    input:focus { outline:none; border-color:#ff6b35; box-shadow:0 0 0 3px rgba(255,107,53,0.3); background: rgba(40,40,50,0.9); }
    button { background: linear-gradient(135deg, #ff6b35, #d62828); color:white; border:2px solid #ff8555; cursor:pointer; font-weight:900; min-width:140px; position:relative; overflow:hidden; text-transform:uppercase; letter-spacing:1px; }
    button:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(255,107,53,0.6); background: linear-gradient(135deg, #d62828, #ff6b35); }
    button:active { transform:translateY(0); }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    .history { margin-top:25px; }
    .history-header { font-size:1.5em; font-weight:900; margin-bottom:15px; color:#ff6b35; display:flex; align-items:center; gap:10px; text-transform:uppercase; letter-spacing:2px; border-bottom:2px solid #ff6b35; padding-bottom:10px; }
    .entry { display:flex; justify-content:space-between; align-items:center; background: rgba(30,30,40,0.8); padding:15px 20px; border-radius:0; margin-bottom:10px; border-left:4px solid #ff6b35; border:2px solid #444; transition:all 0.3s ease; animation:fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity:0; transform:translateX(-20px); } to { opacity:1; transform:translateX(0); } }
    .entry:hover { transform:translateX(5px); box-shadow:0 4px 12px rgba(255,107,53,0.3); background: rgba(40,40,50,0.9); border-color:#ff6b35; }
    .entry-info { display:flex; align-items:center; gap:15px; font-size:1.1em; }
    .entry-weight { font-weight:900; color:#ff6b35; font-size:1.3em; }
    .entry-date { color:#aaa; font-weight:bold; }
    .delete { background: linear-gradient(135deg, #dc2626, #991b1b); color:white; border:2px solid #ef4444; padding:8px 16px; border-radius:0; cursor:pointer; font-weight:900; transition:all 0.3s ease; text-transform:uppercase; }
    .delete:hover { transform:scale(1.1); box-shadow:0 4px 12px rgba(239,68,68,0.6); }
    .achievement { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0); background: linear-gradient(135deg, #ff6b35, #d62828); color:white; padding:40px; border-radius:0; box-shadow:0 20px 60px rgba(0,0,0,0.9); z-index:1000; text-align:center; font-size:2em; font-weight:900; border:4px solid #fff; text-transform:uppercase; letter-spacing:2px; animation:achievement 2s ease-out; }
    @keyframes achievement { 0% { transform:translate(-50%,-50%) scale(0) rotate(-180deg); } 50% { transform:translate(-50%,-50%) scale(1.2) rotate(10deg); } 70% { transform:translate(-50%,-50%) scale(0.9) rotate(-5deg); } 100% { transform:translate(-50%,-50%) scale(0) rotate(0deg); } }
    .empty-state { text-align:center; padding:60px 20px; color:#888; }
    .empty-state-icon { font-size:4em; margin-bottom:20px; }
    .empty-state-text { font-size:1.3em; margin-bottom:10px; color:#ff6b35; font-weight:900; text-transform:uppercase; }
    .loading { text-align:center; padding:20px; color:#ff6b35; font-weight:900; }
    .error { background: rgba(220,38,38,0.2); color:#ff6b6b; padding:15px; margin-bottom:20px; border:2px solid #dc2626; text-align:center; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚ö° WARRIOR ZONE ‚ö°</h1>
      <p class="tagline">Dominate. Conquer. Achieve.</p>
    </div>

    <div id="errorMessage" class="error" style="display:none;"></div>

    <div class="motivation-banner" id="motivationBanner">NO EXCUSES. JUST RESULTS.</div>

    <div class="quote-section" id="quoteSection">
      <div id="quoteText">"The only bad workout is the one that didn't happen."</div>
      <div class="quote-author" id="quoteAuthor">- Unknown</div>
    </div>

    <div class="cards">
      <div class="card start" id="startCard">
        <span class="card-label">Starting</span>
        <span class="card-value">-- kg</span>
      </div>
      <div class="card current" id="currentCard">
        <span class="card-label">Current</span>
        <span class="card-value">-- kg</span>
      </div>
      <div class="card change-up" id="changeCard">
        <span class="card-label">Change</span>
        <span class="card-value">-- kg</span>
      </div>
      <div class="card streak" id="streakCard">
        <span class="card-label">Logs</span>
        <span class="card-value">0</span>
      </div>
    </div>

    <div class="chart-container">
      <canvas id="weightChart"></canvas>
    </div>

    <div class="form">
      <input type="date" id="dateInput" />
      <input type="number" step="0.1" placeholder="Weight (kg)" id="weightInput" />
      <button onclick="addEntry()" id="addButton">üí™ LOG IT</button>
    </div>

    <div class="history">
      <div class="history-header">üî• BATTLE LOG</div>
      <div id="historyList"><div class="loading">LOADING...</div></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api/entries';
    let entries = [];

    // Authentication Check
    async function checkAuthProgress() {
      try {
        const response = await fetch('/api/auth/status', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.authenticated) {
          window.location.href = '/login.html';
        }
      } catch (error) {
        window.location.href = '/login.html';
      }
    }

    // Run auth check immediately
    checkAuthProgress();

    const motivationalMessages = [
      "NO PAIN, NO GAIN! üí™","PUSH YOUR LIMITS! üî•","BEAST MODE ACTIVATED! ‚ö°",
      "TRAIN LIKE A WARRIOR! ‚öîÔ∏è","EARN YOUR BODY! üíÄ","STRONGER EVERY DAY! üèãÔ∏è",
      "UNLEASH THE BEAST! ü¶Å","CONQUER YOURSELF! üëä","IRON SHARPENS IRON! ‚õìÔ∏è",
      "NEVER SURRENDER! üéØ"
    ];

    const fitnessQuotes = [
      { text:"The body achieves what the mind believes.", author:"Unknown" },
      { text:"Strength doesn't come from what you can do. It comes from overcoming the things you once thought you couldn't.", author:"Rikki Rogers" },
      { text:"The only bad workout is the one that didn't happen.", author:"Unknown" },
      { text:"Success isn't always about greatness. It's about consistency. Consistent hard work leads to success.", author:"Dwayne Johnson" },
      { text:"Your body can stand almost anything. It's your mind that you have to convince.", author:"Andrew Murphy" },
      { text:"The resistance that you fight physically in the gym and the resistance that you fight in life can only build a strong character.", author:"Arnold Schwarzenegger" },
      { text:"Don't count the days. Make the days count.", author:"Muhammad Ali" },
      { text:"The pain you feel today will be the strength you feel tomorrow.", author:"Unknown" },
      { text:"If it doesn't challenge you, it doesn't change you.", author:"Fred DeVito" },
      { text:"The only person you are destined to become is the person you decide to be.", author:"Ralph Waldo Emerson" }
    ];

    const achievementMessages = [
      "‚ö° FIRST BLOOD! WARRIOR AWAKENED!","üî• 5 LOGS! MOMENTUM BUILDING!",
      "üí™ 10 LOGS! DEDICATION UNLOCKED!","‚öîÔ∏è 20 LOGS! UNSTOPPABLE FORCE!","üèÜ 30 LOGS! LEGEND STATUS!"
    ];

    let currentQuoteIndex = 0;

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = `‚ö†Ô∏è ${message}`;
      errorDiv.style.display = 'block';
      setTimeout(() => { errorDiv.style.display = 'none'; }, 5000);
    }

    function updateQuote() {
      currentQuoteIndex = (currentQuoteIndex + 1) % fitnessQuotes.length;
      const quote = fitnessQuotes[currentQuoteIndex];
      document.getElementById('quoteText').textContent = `"${quote.text}"`;
      document.getElementById('quoteAuthor').textContent = `- ${quote.author}`;
    }

    const ctx = document.getElementById("weightChart").getContext("2d");
    let weightChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          label: "Weight (kg)",
          data: [],
          borderColor: "#ff6b35",
          backgroundColor: "rgba(255, 107, 53, 0.2)",
          fill: true,
          tension: 0.2,
          borderWidth: 4,
          pointRadius: 7,
          pointHoverRadius: 10,
          pointBackgroundColor: "#ff6b35",
          pointBorderColor: "#fff",
          pointBorderWidth: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { 
            display: true,
            labels: { font:{ size:14, weight:'bold'}, color:'#ff6b35' }
          }
        },
        scales: {
          y: { beginAtZero:false, grid:{color:'rgba(255,255,255,0.1)'}, ticks:{ font:{size:12, weight:'bold'}, color:'#ddd'} },
          x: { grid:{color:'rgba(255,255,255,0.1)'}, ticks:{ font:{size:12, weight:'bold'}, color:'#ddd'} }
        }
      }
    });

    function updateMotivation() {
      const banner = document.getElementById('motivationBanner');
      const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
      banner.textContent = message;
    }

    function showAchievement(message) {
      const achievement = document.createElement('div');
      achievement.className = 'achievement';
      achievement.textContent = message;
      document.body.appendChild(achievement);
      setTimeout(()=>achievement.remove(),2000);
    }

    function updateUI() {
      weightChart.data.labels = entries.map(e => e.date);
      weightChart.data.datasets[0].data = entries.map(e => e.weight);
      weightChart.update();

      if (entries.length>0) {
        const start = entries[0].weight;
        const current = entries[entries.length-1].weight;
        const change = current-start;

        document.getElementById("startCard").innerHTML = `<span class="card-label">Starting</span><span class="card-value">${start} kg</span>`;
        document.getElementById("currentCard").innerHTML = `<span class="card-label">Current</span><span class="card-value">${current} kg</span>`;

        const changeCard = document.getElementById("changeCard");
        changeCard.innerHTML = `<span class="card-label">Change</span><span class="card-value">${change>=0?"+":""}${change.toFixed(1)} kg</span>`;
        changeCard.className = "card " + (change<0?"change-down":"change-up");

        document.getElementById("streakCard").innerHTML = `<span class="card-label">Logs</span><span class="card-value">${entries.length}</span>`;

        updateMotivation();
      }

      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";

      if (entries.length===0) {
        historyList.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üí™</div><div class="empty-state-text">No Logs Yet</div><p>Start your journey now, warrior!</p></div>`;
      } else {
        entries.slice().reverse().forEach(entry=>{
          const div = document.createElement("div");
          div.className="entry";
          div.innerHTML=`<div class="entry-info"><span class="entry-weight">${entry.weight} kg</span><span class="entry-date">üìÖ ${entry.date}</span></div><button class="delete" onclick="deleteEntry(${entry.id})">DELETE</button>`;
          historyList.appendChild(div);
        });
      }
    }

    async function loadEntries() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Failed to load entries');
        entries = await response.json();
        updateUI();
      } catch (error) {
        console.error('Error loading entries:', error);
        showError('Failed to load data. Make sure the server is running!');
        document.getElementById('historyList').innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><div class="empty-state-text">Connection Error</div><p>Check if the server is running on port 3000</p></div>`;
      }
    }

    async function addEntry() {
      const date = document.getElementById("dateInput").value;
      const weight = parseFloat(document.getElementById("weightInput").value);
      
      if(!date || !weight){
        showError('Enter both date and weight!');
        return;
      }

      const button = document.getElementById('addButton');
      button.disabled = true;
      button.textContent = 'LOGGING...';

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ date, weight })
        });

        if (!response.ok) throw new Error('Failed to add entry');

        await loadEntries();

        const count = entries.length;
        if(count===1) showAchievement(achievementMessages[0]);
        else if(count===5) showAchievement(achievementMessages[1]);
        else if(count===10) showAchievement(achievementMessages[2]);
        else if(count===20) showAchievement(achievementMessages[3]);
        else if(count===30) showAchievement(achievementMessages[4]);

        document.getElementById("dateInput").value="";
        document.getElementById("weightInput").value="";
      } catch (error) {
        console.error('Error adding entry:', error);
        showError('Failed to save entry!');
      } finally {
        button.disabled = false;
        button.textContent = 'üí™ LOG IT';
      }
    }

    async function deleteEntry(id) {
      if (!confirm('Delete this entry?')) return;

      try {
        const response = await fetch(`${API_URL}/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) throw new Error('Failed to delete entry');

        await loadEntries();
      } catch (error) {
        console.error('Error deleting entry:', error);
        showError('Failed to delete entry!');
      }
    }

    loadEntries();
    setInterval(updateMotivation, 5000);
    setInterval(updateQuote, 10000);
  </script>
</body>
</html>